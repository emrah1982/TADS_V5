<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Model YOLO Detection System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/main.css" rel="stylesheet">
    <!-- Scripts -->
    <script type="module" src="/static/js/websocket.js" defer></script>
    <script type="module" src="/static/js/main.js" defer></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-controls">
                <button class="header-btn" onclick="toggleConfigPanel()">
                    âš™ï¸ KonfigÃ¼rasyon
                </button>
                <button class="header-btn" onclick="exportDetectionData()">
                    ğŸ“„ Verileri Export Et
                </button>
                <button class="header-btn" onclick="toggleFullscreen()">
                    ğŸ”² Tam Ekran
                </button>
            </div>
            <h1>ğŸ¤– Multi-Model YOLO Detection System</h1>
            <p>YOLO11 (Genel) + Farm Model (TarÄ±m) - Ã‡oklu video kaynak yÃ¶netimi</p>
        </div>

        <div id="alerts"></div>

        <!-- Model Status Panel -->
        <div class="model-status-panel">
            <h2>ğŸ”¬ Model Durumu ve Kontrol</h2>
            
            <div class="model-controls">
                <!-- General Model Card -->
                <div class="model-card general" id="general-model-card">
                    <div class="model-header">
                        <div class="model-title">
                            <span class="status-indicator" id="general-model-status"></span>
                            ğŸ§  YOLO11 (Genel Model)
                        </div>
                        <div class="model-toggle">
                            <label class="switch">
                                <input type="checkbox" id="general-model-toggle" checked onchange="toggleModel('general')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="model-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="general-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="general-detections">0</div>
                            <div class="stat-label">Toplam Tespit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="general-classes">80</div>
                            <div class="stat-label">SÄ±nÄ±f SayÄ±sÄ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="general-time">0ms</div>
                            <div class="stat-label">Ortalama SÃ¼re</div>
                        </div>
                    </div>
                    <div class="model-description">
                        Ä°nsan, hayvan (Koyun, Ä°nek, KeÃ§i, At, KÃ¶pek) vb.
                    </div>
                </div>

                <!-- Farm Model Card -->
                <div class="model-card farm" id="farm-model-card">
                    <div class="model-header">
                        <div class="model-title">
                            <span class="status-indicator" id="farm-model-status"></span>
                            ğŸŒ± Farm Model (TarÄ±m)
                        </div>
                        <div class="model-toggle">
                            <label class="switch">
                                <input type="checkbox" id="farm-model-toggle" checked onchange="toggleModel('farm')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="model-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="farm-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="farm-detections">0</div>
                            <div class="stat-label">Toplam Tespit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="farm-classes">53</div>
                            <div class="stat-label">SÄ±nÄ±f SayÄ±sÄ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="farm-time">0ms</div>
                            <div class="stat-label">Ortalama SÃ¼re</div>
                        </div>
                    </div>
                    <div class="model-description">
                        Domates bitkisi : Mineral eksikliÄŸi, hastalÄ±k, zararlÄ±, olgunluk durumu vb.
                    </div>
                </div>

                <!-- ZararlÄ± Tespit Model Card -->
                <div class="model-card zararli" id="zararli-model-card">
                    <div class="model-header">
                        <div class="model-title">
                            <span class="status-indicator" id="zararli-model-status"></span>
                            ğŸ› ZararlÄ± Tespit Modeli
                        </div>
                        <div class="model-toggle">
                            <label class="switch">
                                <input type="checkbox" id="zararli-model-toggle" onchange="toggleModel('zararli')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="model-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="zararli-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="zararli-detections">0</div>
                            <div class="stat-label">Toplam Tespit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="zararli-classes">-</div>
                            <div class="stat-label">SÄ±nÄ±f SayÄ±sÄ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="zararli-time">0ms</div>
                            <div class="stat-label">Ortalama SÃ¼re</div>
                        </div>
                    </div>
                    <div class="model-description">
                        TarÄ±msal zararlÄ± bÃ¶cek ve haÅŸere tespiti
                    </div>
                </div>

                <!-- Domates Mineral Tespit Model Card -->
                <div class="model-card domates-mineral" id="domates-mineral-model-card">
                    <div class="model-header">
                        <div class="model-title">
                            <span class="status-indicator" id="domates-mineral-model-status"></span>
                            ğŸ§ª Domates Mineral Tespit
                        </div>
                        <div class="model-toggle">
                            <label class="switch">
                                <input type="checkbox" id="domates-mineral-model-toggle" onchange="toggleModel('domatesMineral')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="model-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="domates-mineral-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-mineral-detections">0</div>
                            <div class="stat-label">Toplam Tespit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-mineral-classes">-</div>
                            <div class="stat-label">SÄ±nÄ±f SayÄ±sÄ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-mineral-time">0ms</div>
                            <div class="stat-label">Ortalama SÃ¼re</div>
                        </div>
                    </div>
                    <div class="model-description">
                        Domates bitkilerinde mineral eksikliÄŸi tespiti
                    </div>
                </div>

                <!-- Domates HastalÄ±k Tespit Model Card -->
                <div class="model-card domates-hastalik" id="domates-hastalik-model-card">
                    <div class="model-header">
                        <div class="model-title">
                            <span class="status-indicator" id="domates-hastalik-model-status"></span>
                            ğŸ¦  Domates HastalÄ±k Tespit
                        </div>
                        <div class="model-toggle">
                            <label class="switch">
                                <input type="checkbox" id="domates-hastalik-model-toggle" onchange="toggleModel('domatesHastalik')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="model-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="domates-hastalik-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-hastalik-detections">0</div>
                            <div class="stat-label">Toplam Tespit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-hastalik-classes">-</div>
                            <div class="stat-label">SÄ±nÄ±f SayÄ±sÄ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-hastalik-time">0ms</div>
                            <div class="stat-label">Ortalama SÃ¼re</div>
                        </div>
                    </div>
                    <div class="model-description">
                        Domates bitkilerinde hastalÄ±k tespiti
                    </div>
                </div>

                <!-- Domates Olgunluk Tespit Model Card -->
                <div class="model-card domates-olgunluk" id="domates-olgunluk-model-card">
                    <div class="model-header">
                        <div class="model-title">
                            <span class="status-indicator" id="domates-olgunluk-model-status"></span>
                            ğŸ… Domates Olgunluk Tespit
                        </div>
                        <div class="model-toggle">
                            <label class="switch">
                                <input type="checkbox" id="domates-olgunluk-model-toggle" onchange="toggleModel('domatesOlgunluk')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="model-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="domates-olgunluk-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-olgunluk-detections">0</div>
                            <div class="stat-label">Toplam Tespit</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-olgunluk-classes">-</div>
                            <div class="stat-label">SÄ±nÄ±f SayÄ±sÄ±</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domates-olgunluk-time">0ms</div>
                            <div class="stat-label">Ortalama SÃ¼re</div>
                        </div>
                    </div>
                    <div class="model-description">
                        Domates meyvelerinin olgunluk durumu tespiti
                    </div>
                </div>
            </div>
        </div>

        <!-- Confidence Threshold Control -->
        <div class="confidence-control">
            <h3>ğŸ¯ GÃ¼ven EÅŸiÄŸi (Confidence Threshold)</h3>
            <div class="confidence-container">
                <label for="confidence-slider">GÃ¼ven EÅŸiÄŸi: <span id="confidence-value">0.5</span></label>
                <input type="range" id="confidence-slider" class="confidence-slider" 
                       min="0.1" max="0.9" step="0.05" value="0.5" 
                       onchange="updateConfidenceThreshold(this.value)">
            </div>
            <div class="confidence-description">
                DÃ¼ÅŸÃ¼k deÄŸerler daha fazla tespit (daha az kesin), yÃ¼ksek deÄŸerler daha az tespit (daha kesin)
            </div>
        </div>

        <!-- Performance Overview -->
        <div class="performance-grid">
            <div class="performance-card">
                <div class="performance-value general" id="total-general-detections">0</div>
                <div class="performance-label">Genel Model Tespitleri</div>
            </div>
            <div class="performance-card">
                <div class="performance-value farm" id="total-farm-detections">0</div>
                <div class="performance-label">Farm Model Tespitleri</div>
            </div>
            <div class="performance-card">
                <div class="performance-value zararli" id="total-zararli-detections">0</div>
                <div class="performance-label">ZararlÄ± Tespit</div>
            </div>
            <div class="performance-card">
                <div class="performance-value domates-mineral" id="total-domates-mineral-detections">0</div>
                <div class="performance-label">Mineral Tespit</div>
            </div>
            <div class="performance-card">
                <div class="performance-value domates-hastalik" id="total-domates-hastalik-detections">0</div>
                <div class="performance-label">HastalÄ±k Tespit</div>
            </div>
            <div class="performance-card">
                <div class="performance-value domates-olgunluk" id="total-domates-olgunluk-detections">0</div>
                <div class="performance-label">Olgunluk Tespit</div>
            </div>
            <div class="performance-card">
                <div class="performance-value total" id="total-combined-detections">0</div>
                <div class="performance-label">Toplam Tespit</div>
            </div>
            <div class="performance-card">
                <div class="performance-value total" id="system-fps">0</div>
                <div class="performance-label">Sistem FPS</div>
            </div>
        </div>

        <!-- Video Sources Control -->
        <div class="control-panel">
            <h2>ğŸ“¹ Video KaynaklarÄ± KontrolÃ¼</h2>
            
            <div class="source-controls">
                <!-- Local Camera -->
                <div class="source-card" id="local-camera-card">
                    <h3>
                        <span class="status-indicator" id="local-camera-status"></span>
                        ğŸ“· Local Kamera
                    </h3>
                    <div class="source-details">
                        <div class="camera-select">
                            <label for="camera-id">Kamera SeÃ§:</label>
                            <select id="camera-id" class="form-select">
                                <option value="0">VarsayÄ±lan Kamera</option>
                                <option value="1">Kamera 1</option>
                                <option value="2">Kamera 2</option>
                            </select>
                        </div>
                        <div class="source-controls">
                            <button class="btn btn-success" onclick="startLocalCamera()">BaÅŸlat</button>
                            <button class="btn btn-danger" onclick="stopLocalCamera()">Durdur</button>
                        </div>
                    </div>
                </div>

                <!-- DJI Drone -->
                <div class="source-card" id="dji-drone-card">
                    <h3>
                        <span class="status-indicator" id="dji-drone-status"></span>
                        ğŸš DJI Drone
                    </h3>
                    <div class="source-inputs">
                        <input type="text" id="dji-connection" placeholder="Connection String" value="udp://:11111">
                        <div class="source-buttons">
                            <button class="btn btn-primary" onclick="startDJIDrone()">
                                <span id="dji-drone-btn-text">BaÅŸlat</span>
                            </button>
                            <button class="btn btn-danger" onclick="stopDJIDrone()">Durdur</button>
                        </div>
                    </div>
                </div>

                <!-- Parrot Anafi -->
                <div class="source-card" id="parrot-anafi-card">
                    <h3>
                        <span class="status-indicator" id="parrot-anafi-status"></span>
                        ğŸ¦œ Parrot Anafi
                    </h3>
                    <div class="source-inputs">
                        <input type="text" id="anafi-ip" placeholder="Drone IP" value="192.168.42.1">
                        <div class="source-buttons">
                            <button class="btn btn-primary" onclick="startParrotAnafi()">
                                <span id="parrot-anafi-btn-text">BaÅŸlat</span>
                            </button>
                            <button class="btn btn-danger" onclick="stopParrotAnafi()">Durdur</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Streams -->
        <div class="video-grid" id="video-grid">
            <!-- Video streams will be added here dynamically -->
        </div>

        <!-- Detection Results -->
        <div class="detections-grid">
            <!-- General Model Detections -->
            <div class="detection-panel general">
                <h2>ğŸ§  Genel Model Tespitleri</h2>
                <div id="general-detections-list">
                    <p class="no-detections">HenÃ¼z genel tespit bulunamadÄ±...</p>
                </div>
            </div>

            <!-- Farm Model Detections -->
            <div class="detection-panel farm">
                <h2>ğŸŒ± Farm Model Tespitleri</h2>
                <div id="farm-detections-list">
                    <p class="no-detections">HenÃ¼z farm tespiti bulunamadÄ±...</p>
                </div>
            </div>

            <!-- ZararlÄ± Tespit Model Detections -->
            <div class="detection-panel zararli">
                <h2>ğŸ› ZararlÄ± Tespit SonuÃ§larÄ±</h2>
                <div id="zararli-detections-list">
                    <p class="no-detections">HenÃ¼z zararlÄ± tespiti bulunamadÄ±...</p>
                </div>
            </div>

            <!-- Domates Mineral Tespit Model Detections -->
            <div class="detection-panel domates-mineral">
                <h2>ğŸ§ª Mineral Tespit SonuÃ§larÄ±</h2>
                <div id="domates-mineral-detections-list">
                    <p class="no-detections">HenÃ¼z mineral tespiti bulunamadÄ±...</p>
                </div>
            </div>

            <!-- Domates HastalÄ±k Tespit Model Detections -->
            <div class="detection-panel domates-hastalik">
                <h2>ğŸ¦  HastalÄ±k Tespit SonuÃ§larÄ±</h2>
                <div id="domates-hastalik-detections-list">
                    <p class="no-detections">HenÃ¼z hastalÄ±k tespiti bulunamadÄ±...</p>
                </div>
            </div>

            <!-- Domates Olgunluk Tespit Model Detections -->
            <div class="detection-panel domates-olgunluk">
                <h2>ğŸ… Olgunluk Tespit SonuÃ§larÄ±</h2>
                <div id="domates-olgunluk-detections-list">
                    <p class="no-detections">HenÃ¼z olgunluk tespiti bulunamadÄ±...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Config Management Overlay -->
    <div class="config-overlay" id="config-overlay" onclick="toggleConfigPanel()">
        <div class="config-panel" onclick="event.stopPropagation()">
            <div class="config-header">
                <h2>âš™ï¸ KonfigÃ¼rasyon YÃ¶netimi</h2>
                <button class="btn btn-danger" onclick="toggleConfigPanel()">âœ• Kapat</button>
            </div>
            
            <div class="config-tabs">
                <button class="config-tab active" onclick="showConfigTab('models')">ğŸ¤– Modeller</button>
                <button class="config-tab" onclick="showConfigTab('classes')">ğŸ·ï¸ SÄ±nÄ±flar</button>
                <button class="config-tab" onclick="showConfigTab('templates')">ğŸ“‹ Åablonlar</button>
                <button class="config-tab" onclick="showConfigTab('import-export')">ğŸ“ Ä°Ã§e/DÄ±ÅŸa Aktar</button>
                <button class="config-tab" onclick="showConfigTab('statistics')">ğŸ“Š Ä°statistikler</button>
            </div>
            
            <!-- Models Tab -->
            <div id="config-models" class="config-content active">
                <h3>Model KonfigÃ¼rasyonlarÄ±</h3>
                <div id="models-list">
                    <!-- Models will be loaded here -->
                </div>
            </div>
            
            <!-- Classes Tab -->
            <div id="config-classes" class="config-content">
                <h3>SÄ±nÄ±f YÃ¶netimi</h3>
                <div class="class-management">
                    <label for="model-select">Model SeÃ§in:</label>
                    <select id="model-select" onchange="loadModelClasses()">
                        <option value="">Bir model seÃ§in...</option>
                    </select>
                    <button class="btn btn-success" onclick="showAddClassModal()">â• SÄ±nÄ±f Ekle</button>
                </div>
                <div id="classes-grid" class="class-grid">
                    <!-- Classes will be loaded here -->
                </div>
            </div>
            
            <!-- Templates Tab -->
            <div id="config-templates" class="config-content">
                <h3>HazÄ±r Åablonlar</h3>
                <p class="template-description">Belirli senaryolar iÃ§in Ã¶nceden yapÄ±landÄ±rÄ±lmÄ±ÅŸ ayarlar</p>
                <div id="templates-list">
                    <!-- Templates will be loaded here -->
                </div>
            </div>
            
            <!-- Import/Export Tab -->
            <div id="config-import-export" class="config-content">
                <h3>KonfigÃ¼rasyon Ä°Ã§e/DÄ±ÅŸa Aktarma</h3>
                
                <div class="import-export-grid">
                    <!-- Export Section -->
                    <div class="export-section">
                        <h4>ğŸ“¤ DÄ±ÅŸa Aktar</h4>
                        <div class="format-selection">
                            <label>Format:</label>
                            <select id="export-format">
                                <option value="yaml">YAML</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>
                        <div class="export-buttons">
                            <button class="btn btn-primary" onclick="exportConfig()">DÄ±ÅŸa Aktar</button>
                            <button class="btn btn-success" onclick="backupConfig()">Yedek Al</button>
                        </div>
                    </div>
                    
                    <!-- Import Section -->
                    <div class="import-section">
                        <h4>ğŸ“¥ Ä°Ã§e Aktar</h4>
                        <div class="file-drop-zone" id="file-drop-zone" onclick="document.getElementById('config-file').click()">
                            <div class="drop-icon">ğŸ—‚ï¸</div>
                            <div>Config dosyasÄ±nÄ± buraya sÃ¼rÃ¼kleyin</div>
                            <div>veya tÄ±klayarak seÃ§in</div>
                        </div>
                        <input type="file" id="config-file" accept=".yaml,.yml,.json" style="display: none;" onchange="handleConfigFile(this)">
                        <div class="merge-option">
                            <label>
                                <input type="checkbox" id="merge-config"> Mevcut config ile birleÅŸtir
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics Tab -->
            <div id="config-statistics" class="config-content">
                <h3>KonfigÃ¼rasyon Ä°statistikleri</h3>
                <div id="config-stats" class="config-stats-grid">
                    <!-- Statistics will be loaded here -->
                </div>
                
                <h4 class="model-details-title">Model DetaylarÄ±</h4>
                <div id="model-details">
                    <!-- Model details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="add-class-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Yeni SÄ±nÄ±f Ekle</h3>
            <form id="add-class-form" onsubmit="addCustomClass(event)">
                <div class="form-group">
                    <label>Model:</label>
                    <select id="add-class-model" required>
                        <option value="">Model seÃ§in...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>SÄ±nÄ±f ID:</label>
                    <input type="number" id="add-class-id" required>
                </div>
                <div class="form-group">
                    <label>Ä°ngilizce AdÄ±:</label>
                    <input type="text" id="add-class-name" required>
                </div>
                <div class="form-group">
                    <label>TÃ¼rkÃ§e AdÄ±:</label>
                    <input type="text" id="add-class-display-name" required>
                </div>
                <div class="form-group">
                    <label>Renk:</label>
                    <input type="color" id="add-class-color">
                </div>
                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="add-class-enabled" checked> Aktif
                    </label>
                    <label>
                        <input type="checkbox" id="add-class-alert"> Alert
                    </label>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeAddClassModal()">Ä°ptal</button>
                    <button type="submit" class="btn btn-success">Ekle</button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>